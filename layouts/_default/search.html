{{- define "main" }}

<header class="page-header">
    {{- partial "breadcrumbs.html" . }}
    <h1>{{- (printf "%s&nbsp;" .Title ) | htmlUnescape -}}
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
    </h1>
    {{- if .Description }}
    <div class="post-description">
        {{ .Description }}
    </div>
    {{- end }}
    {{- if not (.Param "hideMeta") }}
    <div class="post-meta">
        {{- partial "translation_list.html" . -}}
    </div>
    {{- end }}
</header>

<div id="searchbox">
    <input id="searchInput" autofocus placeholder="{{ .Params.placeholder | default (printf "%s â†µ" .Title) }}"
        aria-label="search" type="search" autocomplete="off" maxlength="64">
    <ul id="searchResults" aria-label="search results"></ul>
</div>

<!-- æ ‡ç­¾åˆ—è¡¨ -->
<div id="tagCloud" class="post-tags">
    {{- $tags := slice }}
    {{- range $name, $taxonomy := .Site.Taxonomies.tags }}
        {{- /* è·å–åŸå§‹æ ‡ç­¾åç§° */ -}}
        {{- $originalName := "" }}
        {{- range $taxonomy }}
            {{- range .Page.Params.tags }}
                {{- if eq (. | urlize) ($name | urlize) }}
                    {{- $originalName = . }}
                {{- end }}
            {{- end }}
        {{- end }}
        {{- if $originalName }}
            {{- $tagInfo := dict "name" $originalName "urlizedName" $name "count" (len $taxonomy) }}
            {{- $tags = $tags | append $tagInfo }}
        {{- end }}
    {{- end }}
    
    {{- $sortedTags := sort (sort $tags "name") "count" "desc" }}
    {{- range $tagInfo := $sortedTags }}
    <a href="/tags/{{ $tagInfo.name | urlize }}/" class="tag-link">
        <span class="tag-name">{{ $tagInfo.name }}</span>
        <span class="tag-count">{{ $tagInfo.count }}</span>
    </a>
    {{- end }}
</div>

<!-- å­—æ•°ç»Ÿè®¡ -->
<div id="contentStats" class="dashboard-container">
    {{- /* è¯»å–å­—æ•°ç»Ÿè®¡æ•°æ® */ -}}
    {{- $wordCountData := .Site.Data.word_count -}}
    
    {{- /* è®¡ç®—æ€»ä½“ç»Ÿè®¡ */ -}}
    {{- $totalPosts := len (where .Site.RegularPages "Type" "posts") -}}
    {{- $totalThoughts := len (where .Site.RegularPages "Section" "thoughts") -}}
    {{- $totalSkyEye := len (where site.RegularPages "Section" "sky-eye") -}}
    
    {{- /* è®¡ç®—ä»Šå¹´ç»Ÿè®¡ */ -}}
    {{- $currentYear := now.Year -}}
    {{- $thisYearPosts := 0 -}}
    {{- $thisYearThoughts := 0 -}}
    {{- $thisYearSkyEye := 0 -}}
    
    {{- range where .Site.RegularPages "Type" "posts" -}}
        {{- if eq (.Date.Year) $currentYear -}}
            {{- $thisYearPosts = add $thisYearPosts 1 -}}
        {{- end -}}
    {{- end -}}
    
    {{- range where .Site.RegularPages "Section" "thoughts" -}}
        {{- if eq (.Date.Year) $currentYear -}}
            {{- $thisYearThoughts = add $thisYearThoughts 1 -}}
        {{- end -}}
    {{- end -}}
    
    {{- range where .Site.RegularPages "Section" "sky-eye" -}}
        {{- if eq (.Date.Year) $currentYear -}}
            {{- $thisYearSkyEye = add $thisYearSkyEye 1 -}}
        {{- end -}}
    {{- end -}}
    
    <!-- Dashboard æ ‡é¢˜ -->
    <div class="dashboard-header">
        <h2 class="dashboard-title">åˆ›ä½œç»Ÿè®¡</h2>
    </div>
    
    <!-- åˆ†ç±»ç»Ÿè®¡å¡ç‰‡ -->
    <div class="dashboard-grid">
        <!-- ç å­—ç»Ÿè®¡ -->
        <div class="stat-card writing-card">
            <div class="card-header">
                <span class="card-icon">âœï¸</span>
                <h4>ç å­—</h4>
            </div>
            <div class="card-content">
                <div class="stat-number">{{ if $wordCountData }}{{ $wordCountData.this_year.word_count_formatted }}/{{ $wordCountData.total.word_count_formatted }}{{ else }}è®¡ç®—ä¸­...{{ end }}</div>
                <div class="stat-label">ä»Šå¹´/æ€»å…± (ä¸‡å­—)</div>
                <div class="mini-progress">
                    <div class="mini-progress-fill" style="width: {{ if and $wordCountData $wordCountData.total.word_count_raw (gt $wordCountData.total.word_count_raw 0) }}{{ div (mul $wordCountData.this_year.word_count_raw 100) $wordCountData.total.word_count_raw }}{{ else }}0{{ end }}%"></div>
                </div>
            </div>
        </div>
        
        <!-- åšæ–‡ç»Ÿè®¡ -->
        <div class="stat-card posts-card">
            <div class="card-header">
                <span class="card-icon">ğŸ“</span>
                <h4>åšæ–‡</h4>
            </div>
            <div class="card-content">
                <div class="stat-number">{{ $thisYearPosts }}/{{ $totalPosts }}</div>
                <div class="stat-label">ä»Šå¹´/æ€»å…±</div>
                <div class="mini-progress">
                    <div class="mini-progress-fill" style="width: {{ if gt $totalPosts 0 }}{{ div (mul $thisYearPosts 100) $totalPosts }}{{ else }}0{{ end }}%"></div>
                </div>
            </div>
        </div>
        
        <!-- æƒ³æ³•ç»Ÿè®¡ -->
        <div class="stat-card thoughts-card">
            <div class="card-header">
                <span class="card-icon">ğŸ’­</span>
                <h4>æƒ³æ³•</h4>
            </div>
            <div class="card-content">
                <div class="stat-number">{{ $thisYearThoughts }}/{{ $totalThoughts }}</div>
                <div class="stat-label">ä»Šå¹´/æ€»å…±</div>
                <div class="mini-progress">
                    <div class="mini-progress-fill" style="width: {{ if gt $totalThoughts 0 }}{{ div (mul $thisYearThoughts 100) $totalThoughts }}{{ else }}0{{ end }}%"></div>
                </div>
            </div>
        </div>
        
        <!-- å¤©ç©ºä¹‹çœ¼å›¾ç‰‡ç»Ÿè®¡ -->
        <div class="stat-card skyeye-card">
            <div class="card-header">
                <span class="card-icon">ğŸ“¸</span>
                <h4>å¤©ç©ºä¹‹çœ¼å›¾ç‰‡</h4>
            </div>
            <div class="card-content">
                <div class="stat-number">{{ $thisYearSkyEye }}/{{ $totalSkyEye }}</div>
                <div class="stat-label">ä»Šå¹´/æ€»å…±</div>
                <div class="mini-progress">
                    <div class="mini-progress-fill" style="width: {{ if gt $totalSkyEye 0 }}{{ div (mul $thisYearSkyEye 100) $totalSkyEye }}{{ else }}0{{ end }}%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// å½“æœç´¢æ¡†æœ‰è¾“å…¥æ—¶éšè—æ ‡ç­¾å’Œç»Ÿè®¡ä¿¡æ¯
document.getElementById('searchInput').addEventListener('input', function() {
    const tagCloud = document.getElementById('tagCloud');
    const contentStats = document.getElementById('contentStats');
    if (this.value.length > 0) {
        tagCloud.style.display = 'none';
        contentStats.style.display = 'none';
    } else {
        tagCloud.style.display = 'flex';
        contentStats.style.display = 'block';
    }
});
</script>

{{- end }}{{/* end main */}} 
