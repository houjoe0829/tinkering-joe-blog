# 产品需求文档：天空之眼 - 全景照片展示功能

## 1. 背景和目标

### 1.1 背景

用户拥有无人机拍摄的全景照片，希望在个人网站上创建一个专门的栏目来集中展示这些独特的视觉作品，与访问者分享从空中俯瞰的视角。目前网站缺少这样的专属展示空间。

### 1.2 目标

- 在网站上新增一个名为“天空之眼”的独立栏目。
- 提供一个优雅、一致的用户界面来浏览全景照片的缩略图和描述。
- 实现点击缩略图后进入沉浸式全景照片查看体验。
- 确保页面加载性能良好，特别是对于较大的全景图片。
- 功能实现借鉴现有首页列表的交互模式，保持网站体验的一致性。

## 2. 功能设计

### 2.1 导航栏入口

- 在网站顶部的导航栏中，于“搜索”图标和“文章”链接之间，新增一个文本链接：“天空之眼”。
- 点击此链接，用户将导航至“天空之眼”页面。

### 2.2 “天空之眼”列表页面

- **页面路径**：建议为 `/sky-eye/` （或其他商定的友好路径）。
- **内容展示**：
    - 以列表或网格形式展示全景照片对象。
    - 每个对象包含：
        - 一张缩略图 (Thumbnail)。
        - 一段简短的文字描述。
    - **视觉风格**：整体布局、卡片样式应与网站首页的文章列表 (`/posts/`) 保持视觉一致性。
- **排序**：照片对象默认按照 **拍摄时间** 从 **最新到最旧** 排序。
- **加载机制**：
    - 页面首次加载时，仅显示一部分（例如 10 张）最新的照片对象。
    - 列表末尾提供一个“加载更多”按钮。
    - 点击“加载更多”，会异步加载下一批照片对象，并追加到现有列表下方。
    - 加载逻辑和交互效果应与首页文章列表的“加载更多”保持一致。

### 2.3 全景照片查看页面

- **触发方式**：在“天空之眼”列表页面，点击任意一张照片的 **缩略图**。
- **页面内容**：
    - 主要区域用于展示对应的高清全景照片。
    - **加载状态**：由于全景照片文件可能较大，在照片完全加载完成前，页面需要显示一个清晰的“正在加载中...” (Loading) 的提示（例如，使用加载动画或文字）。
    - **交互**：
        - 用户可以通过鼠标拖拽（桌面端）或手指滑动（移动端）来 360 度查看全景照片的各个角度。
        - 依赖 **成熟的第三方库** 来实现此全景查看功能，以确保稳定性和良好的用户体验，避免自行开发。
- **内容来源**：页面需要加载对应照片对象的 **高清全景图** 文件。

### 2.4 内容管理

- 每张全景照片及其相关信息（缩略图路径、高清大图路径、文字描述、拍摄时间）将通过创建一个单独的文件来管理，类似于当前网站管理文章 (`content/posts/`) 的方式。
- 需要定义清晰的文件结构和元数据格式（例如，使用 Markdown Front Matter）。

## 3. 功能实现的阶段

建议将此功能的开发分为以下几个阶段，以便小步快跑，逐步迭代：

- **阶段一：基础框架搭建**
    - 在导航栏添加“天空之眼”入口。
    - 创建“天空之眼”列表页面的基本路由和空模板。
    - 定义全景照片的内容文件结构和元数据格式（例如，使用 Markdown Front Matter）。
    - 手动创建至少一个示例照片内容文件。
    - 创建全景照片查看页面的基本路由和空模板。
- **阶段二：核心查看功能实现**
    - 调研并选择一个合适的第三方全景照片查看库 (Javascript Library)。
    - 在查看页面集成所选的库，加载并显示示例照片的高清全景图。
    - 实现基本的拖拽/滑动查看交互。
    - 实现加载状态提示。
    - 全景照片优化：为了保证加载速度和用户体验，对大尺寸全景照片进行优化处理：
        - 调整分辨率：将原始 8192x4096 分辨率调整为 6000x3000，保持足够清晰度的同时减小文件大小。
        - 使用 WebP 格式：将 JPEG 转换为更高效的 WebP 格式，在保持相同质量的情况下文件尺寸减小约 37%。
        - 质量控制：使用 85% 的质量设置，在文件大小和图像质量之间取得平衡。
        - 优化效果：将 14MB 的原始图片减小到约 1MB（压缩率 93%），显著提高加载速度。
    - （可选）此时可以先实现从一个固定的 URL 或路径加载示例图片进行测试。
- **阶段三：列表页面展示与链接**
    - 实现从内容文件读取数据。
    - 在“天空之眼”列表页面展示照片对象（缩略图+描述）。
    - 实现按拍摄时间排序。
    - 实现点击列表页缩略图，能够正确跳转至查看页面，并传递必要的照片信息以加载对应的全景图。
    - 确保列表项的视觉风格与首页一致。
- **阶段四：完善列表页加载**
    - 对标首页的实现方式，在列表页面添加“加载更多”按钮及相应的加载逻辑。

## 4. 产品验收

完成开发后，需要通过以下 Case 验证功能是否符合需求：

- **导航**：
    - [ ] 导航栏是否正确显示“天空之眼”链接，位置是否在“搜索”和“文章”之间？
    - [ ] 点击“天空之眼”链接是否能正确跳转到列表页面？
- **列表页面**：
    - [ ] 页面是否能成功加载并显示照片对象？
    - [ ] 每个对象是否都包含缩略图和描述？
    - [ ] 照片是否按照拍摄时间从新到旧正确排序？
    - [ ] 列表项的视觉风格是否与首页文章列表一致？
    - [ ] 首次加载时是否只显示了部分照片？
    - [ ] “加载更多”按钮是否存在？点击后是否能加载并追加显示更多照片？加载行为是否与首页一致？
- **查看页面**：
    - [ ] 点击列表页的缩略图是否能跳转到对应的全景照片查看页面？
    - [ ] 查看页面在加载大图时，是否显示了加载提示？
    - [ ] 全景大图加载成功后，是否能正常显示？
    - [ ] 是否可以用鼠标或手指拖动/滑动来查看照片的不同角度？交互是否流畅？
- **内容管理**：
    - [ ] 是否可以方便地通过创建/修改文件的方式来添加/更新全景照片及其信息？
    - [ ] 新增的照片是否能自动出现在列表页（并遵循排序规则）？
- **集成与排除**：
    - [ ] “天空之眼”的内容（照片及其描述）是否 **不会** 出现在网站的 RSS Feed 中？
- **响应式**：
    - [ ] 列表页面和查看页面在不同设备尺寸（桌面、平板、手机）上是否都能良好显示和使用？ 

---

### 天空之眼图片详情页功能实现

1. **详情页功能**  
   - 用户点击图片列表中的任意一张图片后，先进入详情页，而不是直接进入全景浏览页面。
   - 详情页采用响应式设计，在桌面设备上左右布局（图片占65%，信息占35%），在移动设备上上下布局。
   - 整体高度优化为320px，使页面更加紧凑美观。

2. **详情页展示内容**  
   - **标题**：在页面顶部显示用户自定义的图片标题。
   - **描述**：在标题下方显示图片的详细描述，不重复显示。
   - **缩略图**：左侧展示高质量缩略图，底部常驻显示"点击进入沉浸式360度查看"提示，无需鼠标悬停。
   - **拍摄时间**：右侧信息区域显示精确到秒的拍摄时间（格式：2006年01月02日 15:04:05）。
   - **地点信息**：显示图片拍摄的准确地点名称，地点信息在添加图片时写入，不在每次访问时实时转换。
   - **Google Map 链接**：在地点信息下方提供"在 Google Map 查看"按钮，点击后以原始经纬度跳转到 Google 地图。
   - **相关文章**：如果有文章引用该图片，则在详情信息下方展示相关文章列表。

3. **显示逻辑**  
   - 采用条件渲染，仅有内容的字段才会显示，没有内容的字段不显示（不留空）。
   - 每个信息项都配有相应的图标，提升视觉体验。
   - 信息区域采用卡片式设计，有轻微阴影效果，增强层次感。

4. **技术实现要点**  
   - 地理位置信息存储在 Markdown 文件的 front matter 中，包含两个字段：
     - `location`: 人类可读的地点名称（如"浙江省湖州市德清县莫干山"）
     - `coordinates`: 经纬度坐标（如"30.647444,119.820417"）
   - Google Map 跳转链接格式：`https://maps.google.com/?q=纬度,经度`
   - 全景图查看使用 Pannellum 2.5.6 版本实现，支持移动设备触控操作、键盘和鼠标缩放、全屏查看等功能，界面经过自定义优化。
   - 为提升不同设备的观看体验，根据设备类型设置不同的视场角(hfov)：
     - PC设备：hfov = 100（较广的视角，适合大屏幕观看）
     - 移动设备：hfov = 30（较窄的视角，减少小屏幕上的广角变形，提供更聚焦的观看体验）
     - 通过检测用户代理(User Agent)和窗口宽度(≤768px视为移动设备)来区分设备类型
   - 相关文章通过检测内容中的链接引用或 shortcode 引用自动识别并展示。