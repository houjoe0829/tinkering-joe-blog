# 产品需求文档 (PRD): Newsletter 订阅功能

## 1. 背景和目标

### 1.1 背景
用户希望为其现有网站增加 Newsletter (邮件通讯) 功能，以便能够向访客推送更新、资讯等内容，增强用户粘性。当前，项目已初步引入了第三方邮件服务提供商 Brevo 的基础集成文件 (`brevo-frame.html`, `sw.js`)。

### 1.2 目标
-   在网站的"订阅更新"区域设置一个清晰、易用的手动订阅入口。
-   用户点击该入口后，能够顺利弹出 Brevo 提供的邮件订阅表单（弹窗）。
-   用户通过弹窗成功提交邮箱地址后，其信息应被 Brevo 系统有效记录，为后续接收 Newsletter 奠定基础。
-   确保订阅流程简单、顺畅，提升用户体验。

## 2. 功能设计

### 2.1 订阅入口模块
-   **位置**: 网站右上角的"订阅更新"下拉菜单里。
-   **形式**: 增加新的选项，"获取邮件更新"等。
-   **交互**:
    -   鼠标悬停时应有视觉反馈（如颜色变化）。
    -   用户点击该按钮/链接。

### 2.2 订阅弹窗模块
-   **触发**: 用户点击"订阅入口模块"中的按钮/链接后，通过 JavaScript 调用 Brevo 服务 API 来触发。
-   **内容**: 显示 Brevo 预设的邮件订阅表单。该表单至少应包含邮箱输入框和提交按钮。
-   **交互**:
    -   弹窗应在当前页面居中或以用户易于注意到的方式显示。
    -   用户可以在弹窗内输入邮箱地址。
    -   用户点击弹窗内的提交按钮。

### 2.3 数据处理与反馈模块 (主要由 Brevo 服务处理)
-   **数据提交**: 用户在 Brevo 弹窗中提交邮箱后，数据将被发送至 Brevo 服务器。
-   **验证**: Brevo 服务将对邮箱格式进行基本验证。
-   **存储**: 验证通过的邮箱将被存储在 Brevo 后台的用户列表中。
-   **反馈**:
    -   **成功**: Brevo 弹窗应显示订阅成功的提示信息。
    -   **失败**: 若邮箱格式错误或发生其他问题，Brevo 弹窗应显示相应的错误提示。

## 3. 功能实现的阶段

### 阶段 1: Brevo 服务配置与准备
-   **任务1**: 登录 Brevo 平台，创建或配置一个用于网站的邮件订阅表单/弹窗。
-   **任务2**: 获取必要的 Brevo `client_key`。
-   **任务3**: 获取用于手动触发特定 Brevo 表单/弹窗的事件名称或标识符 (例如: `newsletter_subscription_form_manual_trigger`)。
-   **任务4**: 确认 `brevo-frame.html` 和 `sw.js` 文件已正确放置在网站项目中，并能被正确加载。

### 阶段 2: 实现前端订阅入口
-   **任务1**: 确定网站中"订阅更新"区域的具体 HTML 文件或模板。
-   **任务2**: 在该文件中添加"邮件订阅"按钮的 HTML 代码。
    ```html
    <!-- 示例: <button id="manual-brevo-subscribe-button">订阅邮件更新</button> -->
    ```
-   **任务3**: （可选）为按钮添加基础的 CSS 样式，使其美观且符合网站整体风格。

### 阶段 3: 实现弹窗触发逻辑
-   **任务1**: 确保 Brevo SDK (通过 `cdn.brevo.com/js/sdk-loader.js`) 已在相关页面加载并正确初始化。
    ```javascript
    // 示例初始化代码 (应已存在或需添加)
    // window.Brevo = window.Brevo || {};
    // window.Brevo.push = window.Brevo.push || function() {
    //   (window.Brevo.q = window.Brevo.q || []).push(arguments);
    // };
    // Brevo.push(['init', { client_key: 'YOUR_BREVO_CLIENT_KEY' }]);
    ```
-   **任务2**: 编写 JavaScript 代码，为阶段 2 中创建的按钮添加点击事件监听器。
-   **任务3**: 在点击事件的处理函数中，调用 Brevo API 来触发弹窗。
    ```javascript
    // 示例触发代码
    // document.getElementById('manual-brevo-subscribe-button').addEventListener('click', function() {
    //   if (window.Brevo && typeof window.Brevo.push === 'function') {
    //     Brevo.push(['trigger', 'YOUR_BREVO_EVENT_IDENTIFIER']); // 使用阶段 1 获取的事件标识符
    //   } else {
    //     console.error('Brevo SDK not available.');
    //   }
    // });
    ```

### 阶段 4: 测试与部署
-   **任务1**: 在本地开发环境进行完整流程测试：点击按钮 -> 弹窗出现 -> 输入邮箱 -> 提交 -> 检查 Brevo 后台是否收到数据。
-   **任务2**: 测试不同场景，如无效邮箱输入，网络较差时的表现（如果可模拟）。
-   **任务3**: 确认无误后，将代码部署到生产环境。
-   **任务4**: 在生产环境再次进行测试。

## 4. 产品验收

-   **验收标准 1**: 在网站指定的"订阅更新"区域，能够清晰看到"邮件订阅"按钮/链接。
-   **验收标准 2**: 点击"邮件订阅"按钮/链接后，Brevo 的邮件订阅弹窗能够正常、快速地弹出。
-   **验收标准 3**: 在弹窗中输入有效的邮箱地址并点击提交，Brevo 弹窗提示订阅成功。
-   **验收标准 4**: 成功提交后，在 Brevo 后台的对应订阅者列表中可以查找到新提交的邮箱地址。
-   **验收标准 5**: （若 Brevo 表单支持）在弹窗中输入无效格式的邮箱地址（如 `abc@` 或 `abc.com`），弹窗能给出相应的错误提示，阻止提交。
-   **验收标准 6**: 订阅功能在主流浏览器（如 Chrome, Firefox, Safari, Edge 最新版本）上表现一致。
-   **验收标准 7**: 订阅按钮和弹窗在常见的桌面和移动设备屏幕尺寸上显示良好（基本响应式）。 