# 博客内容统计 Dashboard 功能 PRD

## 背景和目标

### 项目背景
Joe 的折腾日记是一个基于 Hugo 的个人博客，包含博文（posts）、随思录（thoughts）和天空之眼（sky-eye）三种内容类型。目前在搜索页面只显示简单的文章数量统计，缺乏对内容创作量的全面了解。

### 功能目标
在搜索页面添加一个自动化的内容统计 Dashboard，让博主能够直观了解自己的创作成果，包括总体统计和年度统计，特别是字数统计功能，帮助量化写作产出。

### 核心价值
- **创作成就感**：通过数据可视化展示创作成果，增强写作动力
- **内容洞察**：了解不同类型内容的创作分布和趋势
- **自动化管理**：无需手动维护，构建时自动更新统计数据

## 功能设计

### 统计维度

#### 字数统计规则
- **中文字符**：计算所有汉字字符数量
- **英文单词**：按空格分隔计算英文单词数量
- **包含内容**：
  - 正文内容
  - 代码块内容
  - 引用文本内容
  - 图片 Alt 文本
- **排除内容**：
  - Markdown 语法标记（如 `#`、`**`、`[]()` 等）
  - 链接 URL（保留链接显示文本）
  - Front matter 元数据
  - HTML 标签

#### 数量统计（已实现）
- 博文总数（posts 目录下的文章）- ✅ 已实现
- 随思录总数（thoughts 目录下的文章）- ✅ 已实现  
- 全景图片总数（sky-eye 目录下的图片）- ✅ 已实现

#### 时间维度
- **全部时间**：所有已发布内容的统计
- **今年统计**：按文章发布日期（date 字段）筛选当年内容
- **时区处理**：统一使用北京时间（Asia/Shanghai）

### 展示设计

#### 显示位置
在搜索页面的标签列表下方，扩展现有的文章总数统计区域。

**现有实现**：
```html
<div id="postCount" class="post-count">
    ☕️ 当前总共 {{ len (where .Site.RegularPages "Type" "posts") }} 篇博文，{{ len (where .Site.RegularPages "Section" "thoughts") }} 条想法，以及 {{ len (where site.RegularPages "Section" "sky-eye") }} 张全景图片！
</div>
```

#### 展示格式
保持简洁的文字风格，分为两个部分：

**第一部分 - 总体统计**
```
📊 总共创作了 [X] 万字，包含 [X] 篇博文，[X] 条想法，以及 [X] 张全景图片！
```

**第二部分 - 今年统计**
```
🎯 今年已创作 [X] 万字，包含 [X] 篇博文，[X] 条想法，以及 [X] 张全景图片！
```

#### 样式要求
- 与现有搜索页面风格保持一致
- 不过于突出，作为辅助信息展示
- 适配移动端显示
- 支持深色/浅色主题切换

### 技术实现流程

#### 数据预处理阶段
1. **单篇文章处理**：
   - 创建 Python 脚本解析 Markdown 文件
   - 提取并清理文本内容
   - 计算中文字符数和英文单词数
   - 将字数信息写入文章的 Front matter

2. **数据汇总**：
   - 构建时读取所有文章的字数信息
   - 按时间维度进行汇总统计
   - 生成 Hugo 数据文件（JSON 格式）

#### 前端展示阶段
- 搜索页面模板读取数据文件
- 渲染统计信息到页面
- 处理数字格式化（万字显示）

## 功能实现的阶段

### 阶段一：基础框架搭建（优先级：高）
**目标**：扩展现有统计展示，添加年度维度和字数占位
**功能范围**：
- 修改搜索页面模板，扩展现有的统计展示区域
- 添加年份筛选功能（基于现有的数量统计逻辑）
- 添加字数统计的占位符（等待阶段二实现）
- 完成样式适配和移动端优化

**验收标准**：
- 搜索页面能正确显示总体和今年两个维度的数量统计
- 字数显示为占位符（如 "计算中..." 或 "0"）
- 移动端显示正常
- 与现有主题风格一致

**现有功能复用**：
- 博文总数：`{{ len (where .Site.RegularPages "Type" "posts") }}`
- 随思录总数：`{{ len (where .Site.RegularPages "Section" "thoughts") }}`
- 全景图片总数：`{{ len (where site.RegularPages "Section" "sky-eye") }}`

### 阶段二：字数统计核心功能（优先级：高）
**目标**：实现准确的字数统计功能
**功能范围**：
- 开发字数统计 Python 脚本
- 实现 Markdown 内容解析和清理
- 中英文字符/单词分离统计
- 将字数信息写入文章 Front matter

**验收标准**：
- 能准确统计中文字符数和英文单词数
- 正确处理各种 Markdown 语法
- 字数信息正确写入文章元数据
- 统计结果与手动计算基本一致

### 阶段三：构建流程集成（优先级：中）
**目标**：将字数统计集成到构建流程
**功能范围**：
- 创建构建前预处理脚本
- 生成汇总统计数据文件
- 模板读取数据文件并展示
- 优化构建性能

**验收标准**：
- 构建时自动更新字数统计
- 搜索页面正确显示字数信息
- 构建时间增加在可接受范围内
- 数据格式化显示正确（万字单位）

### 阶段四：优化和完善（优先级：低）
**目标**：提升用户体验和系统稳定性
**功能范围**：
- 增量更新机制（只处理修改过的文章）
- 错误处理和日志记录
- 统计数据验证机制
- 性能监控和优化

**验收标准**：
- 支持增量更新，提升构建效率
- 具备完善的错误处理机制
- 统计数据准确性得到验证
- 构建过程稳定可靠

## 产品验收

### 功能验收 Case

#### Case 1：基础统计展示
**测试场景**：访问搜索页面查看统计信息
**验收标准**：
- 能看到总体统计和今年统计两个部分
- 数字显示格式正确（万字单位）
- 移动端和桌面端显示正常
- 深色/浅色主题下都能正常显示

#### Case 2：字数统计准确性
**测试场景**：手动验证字数统计结果
**验收标准**：
- 中文字符统计准确（误差 < 5%）
- 英文单词统计准确（误差 < 5%）
- 正确排除 Markdown 语法标记
- 正确包含代码块和引用内容

#### Case 3：时间维度统计
**测试场景**：验证年度统计功能
**验收标准**：
- 今年统计只包含当年发布的内容
- 时区处理正确（北京时间）
- 跨年时统计数据正确切换

#### Case 4：构建流程集成
**测试场景**：执行完整的构建流程
**验收标准**：
- 构建过程无错误
- 新增文章后统计数据自动更新
- 修改文章后字数统计正确更新
- 构建时间在可接受范围内

#### Case 5：边界情况处理
**测试场景**：测试各种特殊内容格式
**验收标准**：
- 空文章不影响统计
- 纯代码文章统计正确
- 包含大量链接的文章处理正确
- 多语言混合内容统计准确

### 性能验收标准
- 构建时间增加不超过 30%
- 统计脚本执行时间 < 60 秒（100 篇文章）
- 生成的数据文件大小 < 10KB
- 搜索页面加载时间无明显增加

### 用户体验验收标准
- 统计信息不干扰搜索功能
- 数字格式易读（使用万字单位）
- 移动端显示友好
- 与整体设计风格协调一致 