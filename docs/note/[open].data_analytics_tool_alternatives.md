# [Open] 数据分析工具选型：Umami

## 1. 需求简介

- **目标**：寻找一款 Google Analytics 的替代品，用于博客的流量统计。
- **核心诉求**：
    - 免费。
    - 能够自托管（Self-Hosted），数据由自己掌控。
    - 提供 API，方便未来构建自定义的数据仪表盘（Dashboard）。

## 2. 备选方案调研

对比了市面上几款主流的开源、自托管网站分析工具，包括 Umami, Plausible, 和 Matomo。

| 特性 | Umami | Plausible | Matomo |
| :--- | :--- | :--- | :--- |
| **定位** | 轻量级、简洁 | 轻量级、隐私优先 | 功能全面、强大 |
| **优点** | 脚本极小(~2KB)、界面清爽、API 友好、部署极简 | 脚本最小(~1KB)、隐私保护极佳、可分享报表 | 功能最接近 GA、扩展性强、100% 数据所有权 |
| **缺点** | 功能相对基础 | 社区生态相对较小 | 部署和维护相对复杂，资源消耗更高 |
| **API 支持** | **优秀**。提供清晰的 REST API，非常适合自定义开发。 | **良好**。提供 Stats API，满足自定义需求。 | **非常强大**。API 功能全面但相对复杂。 |

### 结论

考虑到核心诉求是**通过 API 构建自定义仪表盘**，并且希望**部署和维护成本低**，**Umami** 是当前阶段的最佳选择。它在轻量化、易用性和 API 支持方面取得了很好的平衡。

## 3. Umami 实施方案

### 3.1. 核心功能确认

Umami 完全能够满足基础的统计需求：

- **支持多站点 (Multi-site Support)**：仅需部署一次 Umami 实例，即可在后台添加并管理多个不同的网站，每个网站拥有独立的统计报告和跟踪 ID。
- **页面访问量 (Page Views)**：精确统计每个页面的访问情况。
- **流量来源 (Referrers)**：清晰展示访客的来源渠道（如搜索引擎、社交媒体、其他网站链接等）。
- **其他核心指标**：同时支持访客地理位置、浏览器、操作系统、设备类型等维度的分析。

### 3.2. 部署方案 (Vercel 零成本方案)

Umami 官方推荐在 Vercel 平台上进行部署，可以实现完全免费的托管和运行。

- **应用托管**：Umami 本身是一个 Next.js 应用，可以完美部署在 Vercel 的 Hobby (免费) 套餐上。
- **数据库**：搭配使用 Vercel Postgres，其 Hobby (免费) 套餐提供的额度对于个人博客的统计数据存储来说綽綽有餘。

这种 `Vercel + Vercel Postgres` 的组合方案，是目前部署 Umami 性价比最高、维护成本最低的方式。

### 3.3. 数据备份与维护

数据安全至关重要。由于数据存储在 Vercel Postgres 中，备份策略主要围绕数据库进行。

- **推荐方案**：**自动化脚本备份**。
- **实现方式**：
    1.  **工具**：使用 PostgreSQL 的标准备份工具 `pg_dump`。
    2.  **自动化**：配置一个 **GitHub Action** 定时任务（例如，每天执行一次）。
    3.  **流程**：
        - GitHub Action 自动触发，运行 `pg_dump` 命令连接到 Vercel Postgres 数据库。
        - 将整个数据库导出为一个 `.sql` 文件。
        - 将备份文件自动上传到一个安全的、由自己控制的云存储空间（如 AWS S3, Google Cloud Storage, Backblaze B2 等）。

此方案可以确保您拥有每日的数据快照，并且完全掌控自己的数据备份，实现了高安全性和低成本。

## 4. 建议的实施步骤

1.  在 Vercel 上创建一个新的项目，并关联一个空的 GitHub 仓库。
2.  按照 Umami 官方文档的指引，将 Umami 部署到 Vercel，并连接到 Vercel Postgres 数据库。
3.  完成部署后，获取 Umami 提供的追踪脚本，并将其添加到博客的 `<head>` 标签中。
4.  （可选，但推荐）配置上述的 GitHub Action 自动化备份流程。
5.  观察数据采集情况，确认 Umami 运行正常。
